generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int       @id @default(autoincrement())
  
  // Data Diri
  firstName      String
  lastName       String
  email          String    @unique
  birthDate      DateTime? 
  phoneNumber    String?   @unique
  passwordHash   String?   
  avatarUrl      String?   // URL foto profil dari Google
  
  // --- TAMBAHAN UNTUK PERSONALIZATION UI ---
  heightCm       Int?      // Tinggi user dalam cm
  weightKg       Int?      // Berat user dalam kg
  
  // Web3 & Game Stats
  walletAddress  String?
  coinsBalance   Decimal   @default(0.0) @db.Decimal(18, 2)
  dayStreak      Int       @default(0)
  lastWorkout    DateTime?
  totalWorkouts  Int       @default(0)

  // Avatar Config
  avatarGender   String    @default("MALE")
  equippedTop    String    @default("starter_hair")
  equippedShirt  String    @default("starter_shirt")
  equippedPants  String    @default("starter_pants")
  equippedShoes  String    @default("starter_shoes")

  // Relasi
  blockedApps       BlockedApp[]
  inventory         Inventory[]
  workoutPrefs      WorkoutPreference[]
  transactionQueue  TransactionQueue[]
  purchases         PurchaseHistory[]
  
  createdAt         DateTime  @default(now())
}

model BlockedApp {
  id        Int     @id @default(autoincrement())
  userId    Int
  appName   String
  isActive  Boolean @default(true)
  user      User    @relation(fields: [userId], references: [id])
  
  // Mencegah duplikasi entri blokir
  @@unique([userId, appName]) 
}

model WorkoutPreference {
  id        Int     @id @default(autoincrement())
  userId    Int
  type      String
  target    Int
  isEnabled Boolean @default(true)
  user      User    @relation(fields: [userId], references: [id])
}

model Inventory {
  id        Int      @id @default(autoincrement())
  userId    Int
  itemId    String
  itemType  String
  isOwned   Boolean  @default(true)
  user      User     @relation(fields: [userId], references: [id])

  // Mencegah duplikasi item yang sama
  @@unique([userId, itemId])
}

// Tabel Antrian untuk Worker Blockchain (Minting)
model TransactionQueue {
  id            Int      @id @default(autoincrement())
  userId        Int
  walletAddress String
  amount        String
  workoutType   String
  status        String   @default("PENDING") 
  txHash        String?
  errorMessage  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id])
}

// Tabel Riwayat Pembelian (Mencegah Replay Attack)
model PurchaseHistory {
  id        Int      @id @default(autoincrement())
  userId    Int
  itemId    String
  txHash    String   @unique
  amount    String
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id])
}